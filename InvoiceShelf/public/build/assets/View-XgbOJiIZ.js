import{aR as O,v as j,L as H,f as x,H as Y,k as A,P as Z,r as l,o as d,c as T,b as f,a as t,w as o,t as B,m as y,N as P,O as ee,p as N,J as te,K as w,a5 as ne,e as M,M as G,a6 as ae,l as i,Q as F,z as oe,a7 as re}from"./main-gVTYX-GK.js";import{L as se}from"./LoadingIcon-a_WZlZ1q.js";import{_ as ie}from"./InvoiceIndexDropdown-byki4q4K.js";import{_ as le}from"./SendInvoiceModal-UTVXl-LN.js";import{_ as ce}from"./RecurringInvoiceIndexDropdown-4OnB2Gqf.js";import"./mail-driver-7GZuHyO-.js";const ue={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6.4rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},de={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},me={class:"mb-6"},_e={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},ve={class:"px-2 py-1 pb-2 mb-1 mb-2 text-sm border-b border-gray-200 border-solid"},ge={class:"flex-2"},pe={class:"mt-1 mb-2 text-xs not-italic font-medium leading-5 text-gray-600"},fe={class:"flex-1 whitespace-nowrap right"},ye={class:"text-sm not-italic font-normal leading-5 text-right text-gray-600 est-date"},be={key:0,class:"flex justify-center p-4 items-center"},Ie={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},Be={__name:"RecurringInvoiceViewSidebar",setup(U){const n=O();j.useI18n();const v=H(),r=x(!1),m=x(null),c=x(1),p=x(1),b=x(null),e=Y({orderBy:null,orderByField:null,searchText:null}),R=A(()=>e.orderBy==="asc"||e.orderBy==null);function k(a){return v.params.id==a}async function I(a,_=!1){if(r.value)return;let g={};e.searchText!==""&&e.searchText!==null&&e.searchText!==void 0&&(g.search=e.searchText),e.orderBy!==null&&e.orderBy!==void 0&&(g.orderBy=e.orderBy),e.orderByField!==null&&e.orderByField!==void 0&&(g.orderByField=e.orderByField),r.value=!0;let S=await n.fetchRecurringInvoices({page:a,...g});r.value=!1,m.value=m.value?m.value:[],m.value=[...m.value,...S.data.data],c.value=a||1,p.value=S.data.meta.last_page;let h=m.value.find(E=>E.id==v.params.id);_==!1&&!h&&c.value<p.value&&Object.keys(g).length===0&&I(++c.value),h&&setTimeout(()=>{_==!1&&V()},500)}function V(){const a=document.getElementById(`recurring-invoice-${v.params.id}`);a&&(a.scrollIntoView({behavior:"smooth"}),a.classList.add("shake"),$())}function $(){b.value.addEventListener("scroll",a=>{a.target.scrollTop>0&&a.target.scrollTop+a.target.clientHeight>a.target.scrollHeight-200&&c.value<p.value&&I(++c.value,!0)})}async function s(){m.value=[],I()}function L(){return e.orderBy==="asc"?(e.orderBy="desc",s(),!0):(e.orderBy="asc",s(),!0)}return I(),s=Z.debounce(s,500),(a,_)=>{var z;const g=l("BaseIcon"),S=l("BaseInput"),h=l("BaseButton"),E=l("BaseRadio"),C=l("BaseInputGroup"),D=l("BaseDropdownItem"),q=l("BaseDropdown"),J=l("BaseText"),K=l("BaseRecurringInvoiceStatusBadge"),Q=l("BaseFormatMoney"),W=l("router-link");return d(),T("div",ue,[f("div",de,[f("div",me,[t(S,{modelValue:e.searchText,"onUpdate:modelValue":_[0]||(_[0]=u=>e.searchText=u),placeholder:a.$t("general.search"),type:"text",variant:"gray",onInput:_[1]||(_[1]=u=>s())},{right:o(()=>[t(g,{name:"SearchIcon",class:"h-5 text-gray-400"})]),_:1},8,["modelValue","placeholder"])]),f("div",_e,[t(q,{class:"ml-3",position:"bottom-start"},{activator:o(()=>[t(h,{size:"md",variant:"gray"},{default:o(()=>[t(g,{name:"FilterIcon",class:"h-5"})]),_:1})]),default:o(()=>[f("div",ve,B(a.$t("general.sort_by")),1),t(D,{class:"flex px-1 py-2 cursor-pointer"},{default:o(()=>[t(C,{class:"-mt-3 font-normal"},{default:o(()=>[t(E,{id:"filter_next_invoice_date",modelValue:e.orderByField,"onUpdate:modelValue":[_[2]||(_[2]=u=>e.orderByField=u),s],label:a.$t("recurring_invoices.next_invoice_date"),size:"sm",name:"filter",value:"next_invoice_at"},null,8,["modelValue","label"])]),_:1})]),_:1}),t(D,{class:"flex px-1 py-2 cursor-pointer"},{default:o(()=>[t(C,{class:"-mt-3 font-normal"},{default:o(()=>[t(E,{id:"filter_start_date",modelValue:e.orderByField,"onUpdate:modelValue":[_[3]||(_[3]=u=>e.orderByField=u),s],label:a.$t("recurring_invoices.starts_at"),value:"starts_at",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),t(h,{class:"ml-1",size:"md",variant:"gray",onClick:L},{default:o(()=>[R.value?(d(),y(g,{key:0,name:"SortAscendingIcon",class:"h-5"})):(d(),y(g,{key:1,name:"SortDescendingIcon",class:"h-5"}))]),_:1})])]),f("div",{ref_key:"invoiceListSection",ref:b,class:"h-full overflow-y-scroll border-l border-gray-200 border-solid base-scroll"},[(d(!0),T(P,null,ee(m.value,(u,X)=>(d(),T("div",{key:X},[u?(d(),y(W,{key:0,id:"recurring-invoice-"+u.id,to:`/admin/recurring-invoices/${u.id}/view`,class:te(["flex justify-between side-invoice p-4 cursor-pointer hover:bg-gray-100 items-center border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":k(u.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:o(()=>[f("div",ge,[t(J,{text:u.customer.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),f("div",pe,B(u.invoice_number),1),t(K,{status:u.status,class:"px-1 text-xs"},{default:o(()=>[N(B(u.status),1)]),_:2},1032,["status"])]),f("div",fe,[t(Q,{class:"block mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900",amount:u.total,currency:u.customer.currency},null,8,["amount","currency"]),f("div",ye,B(u.formatted_starts_at),1)])]),_:2},1032,["id","to","class"])):w("",!0)]))),128)),r.value?(d(),T("div",be,[t(se,{class:"h-6 m-1 animate-spin text-primary-400"})])):w("",!0),!((z=m.value)!=null&&z.length)&&!r.value?(d(),T("p",Ie,B(a.$t("invoices.no_matching_invoices")),1)):w("",!0)],512)])}}},he={class:"relative table-container"},xe={__name:"Invoices",setup(U){const n=O(),v=x(null);x(null),ne("$utils");const{t:r}=j.useI18n();x(null),M();const m=G(),c=A(()=>[{key:"invoice_date",label:r("invoices.date"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"invoice_number",label:r("invoices.invoice")},{key:"customer.name",label:r("invoices.customer")},{key:"status",label:r("invoices.status")},{key:"total",label:r("invoices.total")},{key:"actions",label:r("invoices.action"),tdClass:"text-right text-sm font-medium",thClass:"text-right",sortable:!1}]);function p(){return m.hasAbilities([F.DELETE_INVOICE,F.EDIT_INVOICE,F.VIEW_INVOICE,F.SEND_INVOICE])}function b(e){let R=n.newRecurringInvoice.invoices.findIndex(k=>k.id===e);n.newRecurringInvoice.invoices[R]&&(n.newRecurringInvoice.invoices[R].status="SENT")}return(e,R)=>{const k=l("router-link"),I=l("BaseFormatMoney"),V=l("BaseInvoiceStatusBadge"),$=l("BaseTable");return d(),T(P,null,[t(le,{onUpdate:b}),f("div",he,[t($,{ref_key:"table",ref:v,data:i(n).newRecurringInvoice.invoices,columns:c.value,loading:i(n).isFetchingViewData,"placeholder-count":5,class:"mt-5"},ae({"cell-invoice_number":o(({row:s})=>[t(k,{to:{path:`/admin/invoices/${s.data.id}/view`},class:"font-medium text-primary-500"},{default:o(()=>[N(B(s.data.invoice_number),1)]),_:2},1032,["to"])]),"cell-total":o(({row:s})=>[t(I,{amount:s.data.due_amount,currency:s.data.currency},null,8,["amount","currency"])]),"cell-status":o(({row:s})=>[t(V,{status:s.data.status,class:"px-3 py-1"},{default:o(()=>[N(B(s.data.status),1)]),_:2},1032,["status"])]),_:2},[p()?{name:"cell-actions",fn:o(({row:s})=>[t(ie,{row:s.data,table:v.value},null,8,["row","table"])]),key:"0"}:void 0]),1032,["data","columns","loading"])])],64)}}},we={__name:"RecurringInvoiceInfo",setup(U){const n=O(),v=H();let r=A(()=>n.isFetchingViewData);oe(v,()=>{v.params.id&&v.name==="recurring-invoices.view"&&m()},{immediate:!0});async function m(){await n.fetchRecurringInvoice(v.params.id)}return(c,p)=>{const b=l("BaseHeading"),e=l("BaseDescriptionListItem"),R=l("BaseDescriptionList"),k=l("BaseCard");return d(),y(k,{class:"mt-10"},{default:o(()=>[t(b,null,{default:o(()=>[N(B(c.$t("customers.basic_info")),1)]),_:1}),t(R,{class:"mt-5"},{default:o(()=>{var I,V,$,s,L,a,_,g,S,h,E,C,D;return[t(e,{label:c.$t("recurring_invoices.starts_at"),"content-loading":i(r),value:(I=i(n).newRecurringInvoice)==null?void 0:I.formatted_starts_at},null,8,["label","content-loading","value"]),t(e,{label:c.$t("recurring_invoices.next_invoice_date"),"content-loading":i(r),value:(V=i(n).newRecurringInvoice)==null?void 0:V.formatted_next_invoice_at},null,8,["label","content-loading","value"]),($=i(n).newRecurringInvoice)!=null&&$.limit_date&&((s=i(n).newRecurringInvoice)==null?void 0:s.limit_by)!=="NONE"?(d(),y(e,{key:0,label:c.$t("recurring_invoices.limit_date"),"content-loading":i(r),value:(L=i(n).newRecurringInvoice)==null?void 0:L.limit_date},null,8,["label","content-loading","value"])):w("",!0),(a=i(n).newRecurringInvoice)!=null&&a.limit_date&&((_=i(n).newRecurringInvoice)==null?void 0:_.limit_by)!=="NONE"?(d(),y(e,{key:1,label:c.$t("recurring_invoices.limit_by"),"content-loading":i(r),value:(g=i(n).newRecurringInvoice)==null?void 0:g.limit_by},null,8,["label","content-loading","value"])):w("",!0),(S=i(n).newRecurringInvoice)!=null&&S.limit_count?(d(),y(e,{key:2,label:c.$t("recurring_invoices.limit_count"),value:(h=i(n).newRecurringInvoice)==null?void 0:h.limit_count,"content-loading":i(r)},null,8,["label","value","content-loading"])):w("",!0),(E=i(n).newRecurringInvoice)!=null&&E.selectedFrequency?(d(),y(e,{key:3,label:c.$t("recurring_invoices.frequency.title"),value:(D=(C=i(n).newRecurringInvoice)==null?void 0:C.selectedFrequency)==null?void 0:D.label,"content-loading":i(r)},null,8,["label","value","content-loading"])):w("",!0)]}),_:1}),t(b,{class:"mt-8"},{default:o(()=>[N(B(c.$t("invoices.title",2)),1)]),_:1}),t(xe)]),_:1})}}},Te={__name:"View",setup(U){re();const n=O(),v=G();j.useI18n(),M();const r=A(()=>{var c,p;return n.newRecurringInvoice?(p=(c=n.newRecurringInvoice)==null?void 0:c.customer)==null?void 0:p.name:""});function m(){return v.hasAbilities([F.DELETE_RECURRING_INVOICE,F.EDIT_RECURRING_INVOICE])}return(c,p)=>{const b=l("BasePageHeader"),e=l("BasePage");return d(),y(e,{class:"xl:pl-96"},{default:o(()=>[t(b,{title:r.value},{actions:o(()=>[m()?(d(),y(ce,{key:0,row:i(n).newRecurringInvoice},null,8,["row"])):w("",!0)]),_:1},8,["title"]),t(Be),t(we)]),_:1})}}};export{Te as default};
